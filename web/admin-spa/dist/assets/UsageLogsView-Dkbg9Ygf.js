import{aP as B,r as C,aX as q,c as j,q as E,x as u,z as t,u as s,O as y,C as G,K as k,aq as I,aV as H,aT as Q,P as o,Q as w,L as S,ac as A,y as c}from"./vue-vendor-Bsazo-x0.js";import{c as X,s as J,_ as W}from"./index-VMeRaDwr.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const K=()=>({totalCost:0,formattedCost:"$0.000000",totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCacheCreateTokens:0,totalCacheReadTokens:0}),N=()=>({total:0,limit:50,offset:0,hasMore:!1}),M=()=>({search:"",model:"",accountType:"",apiKeyId:"",userId:"",accountId:"",startDate:"",endDate:""}),Y=B("usageLogs",()=>{const f=C([]),m=C(!1),g=C(""),d=C(N()),T=C(K()),x=C(M()),l=()=>{const i={limit:d.value.limit,offset:d.value.offset},p=x.value,b=(v,D)=>{D&&D.toString().trim()!==""&&(i[v]=D.toString().trim())};if(b("search",p.search),b("model",p.model),b("accountType",p.accountType),b("apiKeyId",p.apiKeyId),b("userId",p.userId),b("accountId",p.accountId),p.startDate){const v=new Date(p.startDate);isNaN(v.getTime())||(i.startDate=v.toISOString())}if(p.endDate){const v=new Date(p.endDate);isNaN(v.getTime())||(v.setHours(23,59,59,999),i.endDate=v.toISOString())}return i},n=async()=>{m.value=!0,g.value="";try{const i=await X.get("/admin/usage-logs",{params:l()});i.success?(f.value=i.data.records||[],d.value=i.data.pagination||N(),T.value=i.data.summary||K()):g.value=i.message||"加载使用日志失败"}catch(i){console.error("Failed to load usage logs:",i),g.value=i.message||"加载使用日志失败",J(g.value,"error")}finally{m.value=!1}};return{logs:f,loading:m,error:g,summary:T,pagination:d,filters:x,fetchUsageLogs:n,refresh:async()=>{d.value.offset=0,await n()},resetFilters:()=>{x.value=M()},resetSummaryAndLogs:()=>{f.value=[],T.value=K(),d.value=N()},setLimit:async i=>{d.value.limit=i,d.value.offset=0,await n()},setOffset:async i=>{d.value.offset=Math.max(0,i),await n()}}});function h(f){if(f==null)return"0";const m=Math.abs(f);return m>=1e9?(f/1e9).toFixed(2)+"B":m>=1e6?(f/1e6).toFixed(2)+"M":m>=1e3?(f/1e3).toFixed(1)+"K":f.toLocaleString()}const Z={class:"usage-logs-admin space-y-6"},tt={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},et=["disabled"],st={class:"glass-strong rounded-2xl p-4 shadow-lg sm:p-5"},at={class:"mb-4 grid gap-4 md:grid-cols-2 xl:grid-cols-4"},lt={class:"filter-field"},ot={class:"filter-field"},nt={class:"filter-field"},it={class:"filter-field"},rt={class:"filter-field"},dt={class:"filter-field"},ut={class:"filter-field"},ct={class:"filter-field"},ft={class:"flex flex-wrap gap-3"},pt=["disabled"],mt=["disabled"],gt={class:"glass-strong rounded-2xl p-4 shadow-lg sm:p-5"},xt={key:0,class:"rounded-xl border border-red-400 bg-red-50 p-3 text-sm text-red-700 dark:border-red-500/50 dark:bg-red-900/30 dark:text-red-200"},vt={class:"summary-grid mb-6 grid gap-3 md:grid-cols-3 xl:grid-cols-6"},yt={class:"summary-card"},ht={class:"summary-card"},_t={class:"text-emerald-500"},bt={class:"summary-card"},kt={class:"summary-card"},It={class:"summary-card"},Tt={class:"summary-card"},Ct={key:0,class:"flex justify-center py-16 text-gray-500"},Dt={class:"overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700"},wt={class:"usage-table w-full"},Lt={class:"flex flex-col text-xs"},St={class:"font-semibold text-gray-900 dark:text-gray-100"},Kt={class:"text-gray-500 dark:text-gray-400"},Nt={class:"flex flex-col text-xs"},Vt={class:"font-semibold text-gray-800 dark:text-gray-200"},Ft={class:"text-gray-500 dark:text-gray-400"},Ut={class:"flex flex-col text-xs"},Pt={key:0,class:"text-gray-400"},At={class:"model-badge"},Mt={key:0,class:"ml-2 inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-amber-700 dark:bg-amber-900/30 dark:text-amber-200"},Ot={class:"text-right"},Rt={class:"token-text"},$t={class:"text-right"},zt={class:"token-text"},Bt={class:"text-right"},qt={key:0,class:"cache-badge"},jt={key:1,class:"text-gray-400"},Et={class:"text-right"},Gt={key:0,class:"cache-badge"},Ht={key:1,class:"text-gray-400"},Qt={class:"text-right font-semibold"},Xt={class:"text-right"},Jt={class:"cost-badge"},Wt={class:"flex flex-col text-xs"},Yt={class:"uppercase tracking-wide text-gray-600 dark:text-gray-300"},Zt={class:"text-gray-400"},te={key:0},ee={class:"mt-4 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},se={class:"text-sm text-gray-500 dark:text-gray-400"},ae={class:"flex flex-wrap items-center gap-3"},le={class:"text-sm text-gray-500 dark:text-gray-400"},oe=["value"],ne=["value"],ie={class:"flex gap-2"},re=["disabled"],de=["disabled"],ue={__name:"UsageLogsView",setup(f){const m=Y(),{logs:g,loading:d,error:T,summary:x,pagination:l,filters:n}=q(m),{fetchUsageLogs:_,resetFilters:V}=m,F=[25,50,100,150,200],U=j(()=>{if(!l.value.total||!g.value.length)return"0-0";const r=l.value.offset+1,e=Math.min(l.value.offset+l.value.limit,l.value.total);return`${r}-${e}`}),P=()=>{l.value.offset=0,_()},i=()=>{V(),l.value.offset=0,_()},p=()=>{l.value.offset=0,_()},b=()=>{l.value.offset+l.value.limit>=l.value.total||(l.value.offset+=l.value.limit,_())},v=()=>{l.value.offset!==0&&(l.value.offset=Math.max(0,l.value.offset-l.value.limit),_())},D=r=>{const e=Number(r.target.value)||l.value.limit;l.value.limit=e,l.value.offset=0,_()},O=r=>r?new Date(r).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):"-",R=r=>r?new Date(r).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",$=r=>`$${Number(r||0).toFixed(6)}`,L=r=>{if(!r)return"-";const e=String(r);return e.length<=10?e:`${e.slice(0,4)}...${e.slice(-4)}`},z=r=>r?r.replace("claude-3-5-sonnet-","sonnet-").replace("claude-3-opus-","opus-").replace("claude-3-haiku-","haiku-"):"unknown";return E(()=>{_()}),(r,e)=>(c(),u("div",Z,[t("div",tt,[e[9]||(e[9]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"},"全局使用日志"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"查看所有 API Key 的实时用量")],-1)),t("button",{class:"refresh-btn",disabled:s(d),onClick:p},[t("i",{class:G(["fas fa-sync-alt",{"fa-spin":s(d)}])},null,2),e[8]||(e[8]=y(" 刷新 ",-1))],8,et)]),t("div",st,[t("div",at,[t("div",lt,[e[10]||(e[10]=t("label",null,"关键词",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s(n).search=a),class:"filter-input",placeholder:"请求ID / API Key ID / 模型",type:"text"},null,512),[[I,s(n).search]])]),t("div",ot,[e[11]||(e[11]=t("label",null,"模型",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s(n).model=a),class:"filter-input",placeholder:"模型名称",type:"text"},null,512),[[I,s(n).model]])]),t("div",nt,[e[12]||(e[12]=t("label",null,"API Key ID",-1)),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s(n).apiKeyId=a),class:"filter-input",placeholder:"API Key ID",type:"text"},null,512),[[I,s(n).apiKeyId]])]),t("div",it,[e[13]||(e[13]=t("label",null,"用户 ID",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s(n).userId=a),class:"filter-input",placeholder:"用户 ID",type:"text"},null,512),[[I,s(n).userId]])]),t("div",rt,[e[14]||(e[14]=t("label",null,"账户 ID",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>s(n).accountId=a),class:"filter-input",placeholder:"账户 ID",type:"text"},null,512),[[I,s(n).accountId]])]),t("div",dt,[e[16]||(e[16]=t("label",null,"账户类型",-1)),k(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>s(n).accountType=a),class:"filter-input"},e[15]||(e[15]=[Q('<option value="" data-v-a9c26a70>全部</option><option value="claude" data-v-a9c26a70>Claude</option><option value="claude-console" data-v-a9c26a70>Claude Console</option><option value="openai" data-v-a9c26a70>OpenAI</option><option value="azure_openai" data-v-a9c26a70>Azure OpenAI</option><option value="gemini" data-v-a9c26a70>Gemini</option><option value="bedrock" data-v-a9c26a70>Bedrock</option><option value="droid" data-v-a9c26a70>Droid</option>',8)]),512),[[H,s(n).accountType]])]),t("div",ut,[e[17]||(e[17]=t("label",null,"起始日期",-1)),k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>s(n).startDate=a),class:"filter-input",type:"date"},null,512),[[I,s(n).startDate]])]),t("div",ct,[e[18]||(e[18]=t("label",null,"结束日期",-1)),k(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>s(n).endDate=a),class:"filter-input",type:"date"},null,512),[[I,s(n).endDate]])])]),t("div",ft,[t("button",{class:"primary-btn",disabled:s(d),onClick:P},e[19]||(e[19]=[t("i",{class:"fas fa-search"},null,-1),y(" 查询 ",-1)]),8,pt),t("button",{class:"ghost-btn",disabled:s(d),onClick:i},e[20]||(e[20]=[t("i",{class:"fas fa-undo"},null,-1),y(" 重置 ",-1)]),8,mt)])]),t("div",gt,[s(T)?(c(),u("div",xt,[e[21]||(e[21]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),y(" "+o(s(T)),1)])):(c(),u(w,{key:1},[t("div",vt,[t("div",yt,[e[22]||(e[22]=t("p",null,"总记录",-1)),t("h3",null,o(s(l).total.toLocaleString()),1)]),t("div",ht,[e[23]||(e[23]=t("p",null,"总费用",-1)),t("h3",_t,o(s(x).formattedCost),1)]),t("div",bt,[e[24]||(e[24]=t("p",null,"总 Tokens",-1)),t("h3",null,o(s(h)(s(x).totalTokens)),1)]),t("div",kt,[e[25]||(e[25]=t("p",null,"输入 Tokens",-1)),t("h3",null,o(s(h)(s(x).totalInputTokens)),1)]),t("div",It,[e[26]||(e[26]=t("p",null,"输出 Tokens",-1)),t("h3",null,o(s(h)(s(x).totalOutputTokens)),1)]),t("div",Tt,[e[27]||(e[27]=t("p",null,"缓存 Tokens",-1)),t("h3",null,o(s(h)(s(x).totalCacheCreateTokens+s(x).totalCacheReadTokens)),1)])]),s(d)&&!s(g).length?(c(),u("div",Ct,e[28]||(e[28]=[t("div",{class:"flex items-center gap-3"},[t("i",{class:"fas fa-spinner fa-spin text-2xl text-indigo-500"}),y(" 正在加载使用日志... ")],-1)]))):(c(),u(w,{key:1},[t("div",Dt,[t("table",wt,[e[30]||(e[30]=t("thead",null,[t("tr",null,[t("th",null,"时间"),t("th",null,"API Key"),t("th",null,"用户"),t("th",null,"模型"),t("th",{class:"text-right"},"输入"),t("th",{class:"text-right"},"输出"),t("th",{class:"text-right"},"缓存创建"),t("th",{class:"text-right"},"缓存读取"),t("th",{class:"text-right"},"总计"),t("th",{class:"text-right"},"费用"),t("th",null,"账户")])],-1)),t("tbody",null,[(c(!0),u(w,null,A(s(g),a=>(c(),u("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/40"},[t("td",null,[t("div",Lt,[t("span",St,o(O(a.usageTimestamp)),1),t("span",Kt,o(R(a.usageTimestamp)),1)])]),t("td",null,[t("div",Nt,[t("span",Vt,o(a.apiKeyName||"未命名 Key"),1),t("span",Ft,o(L(a.apiKeyId)),1)])]),t("td",null,[t("div",Ut,[t("span",null,o(a.userId||"-"),1),a.requestId?(c(),u("span",Pt,o(L(a.requestId)),1)):S("",!0)])]),t("td",null,[t("span",At,o(z(a.model)),1),a.isLongContext?(c(),u("span",Mt,"Long")):S("",!0)]),t("td",Ot,[t("span",Rt,o(s(h)(a.inputTokens)),1)]),t("td",$t,[t("span",zt,o(s(h)(a.outputTokens)),1)]),t("td",Bt,[a.cacheCreateTokens?(c(),u("span",qt,o(s(h)(a.cacheCreateTokens)),1)):(c(),u("span",jt,"-"))]),t("td",Et,[a.cacheReadTokens?(c(),u("span",Gt,o(s(h)(a.cacheReadTokens)),1)):(c(),u("span",Ht,"-"))]),t("td",Qt,o(s(h)(a.totalTokens)),1),t("td",Xt,[t("span",Jt,o($(a.cost)),1)]),t("td",null,[t("div",Wt,[t("span",Yt,o(a.accountType||"-"),1),t("span",Zt,o(L(a.accountId)),1)])])]))),128)),s(g).length?S("",!0):(c(),u("tr",te,e[29]||(e[29]=[t("td",{class:"py-10 text-center text-sm text-gray-500 dark:text-gray-400",colspan:"11"},[t("i",{class:"fas fa-inbox mb-2 text-lg"}),y(" 暂无记录，调整筛选条件后重试 ")],-1)])))])])]),t("div",ee,[t("div",se," 显示 "+o(U.value)+" / 共 "+o(s(l).total.toLocaleString())+" 条 ",1),t("div",ae,[t("label",le,[e[31]||(e[31]=y(" 每页 ",-1)),t("select",{class:"filter-input",value:s(l).limit,onChange:D},[(c(),u(w,null,A(F,a=>t("option",{key:a,value:a},o(a),9,ne)),64))],40,oe)]),t("div",ie,[t("button",{class:"pager-btn",disabled:s(l).offset===0||s(d),onClick:v},e[32]||(e[32]=[t("i",{class:"fas fa-chevron-left"},null,-1),y(" 上一页 ",-1)]),8,re),t("button",{class:"pager-btn",disabled:s(l).offset+s(l).limit>=s(l).total||s(d),onClick:b},e[33]||(e[33]=[y(" 下一页 ",-1),t("i",{class:"fas fa-chevron-right"},null,-1)]),8,de)])])])],64))],64))])]))}},ge=W(ue,[["__scopeId","data-v-a9c26a70"]]);export{ge as default};
