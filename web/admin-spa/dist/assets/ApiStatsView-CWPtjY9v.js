import{aP as pt,r as A,c as N,aX as et,x as o,y as r,z as t,O as b,L as P,P as s,u as e,C as D,K as ct,aq as mt,aa as gt,f as xt,Y as vt,Q as X,ac as tt,B as lt,R as G,o as nt,V as yt,I as it,a5 as bt,q as kt,aW as _t,J as ft,av as ht}from"./vue-vendor-Bsazo-x0.js";import{a as Q}from"./apiStats-pwymG62I.js";import{_ as st,A as $t,a as wt}from"./index-BRZpHrQE.js";import{L as Ct}from"./LogoTitle-B4DCgRy6.js";import{T as St}from"./ThemeToggle-9wuC83KP.js";import{b as Tt}from"./vendor-Dr8jvgFu.js";import{_ as Kt}from"./WindowCountdown-BTXjZ8Dc.js";import Lt from"./TutorialView-u7iArli2.js";import"./element-plus-CqiD73Lu.js";const at=pt("apistats",()=>{const W=A(""),K=A(null),a=A(!1),v=A(!1),d=A(!0),g=A(""),c=A("daily"),f=A(null),y=A([]),w=A(null),p=A(null),C=A({siteName:"",siteIcon:"",siteIconData:""}),R=A(!1),h=A([]),k=A([]),u=A(null),i=A([]),M=A([]),B=N(()=>{const m={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return R.value&&u.value?c.value==="daily"?u.value.dailyUsage||m:u.value.monthlyUsage||m:c.value==="daily"?w.value||m:p.value||m}),I=N(()=>{if(!f.value||!B.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const m=B.value,_=f.value.limits;return{tokenUsage:_.tokenLimit>0?Math.min(m.allTokens/_.tokenLimit*100,100):0,costUsage:_.dailyCostLimit>0?Math.min(m.cost/_.dailyCostLimit*100,100):0,requestUsage:_.rateLimitRequests>0?Math.min(m.requests/_.rateLimitRequests*100,100):0}});async function $(){if(R.value)return J();const m=W.value.trim();if(!m){g.value="请输入 API Key";return}if(m.length<10||m.length>512){g.value="API Key 格式无效：长度应在 10-512 个字符之间";return}a.value=!0,g.value="",f.value=null,y.value=[],K.value=null;try{const _=await Q.getKeyId(m);if(_.success){K.value=_.data.id;const j=await Q.getUserStats(K.value);if(j.success)f.value=j.data,await U(),g.value="",Y();else throw new Error(j.message||"查询失败")}else throw new Error(_.message||"获取 API Key ID 失败")}catch(_){console.error("Query stats error:",_),g.value=_.message||"查询统计数据失败，请检查您的 API Key 是否正确",f.value=null,y.value=[],K.value=null}finally{a.value=!1}}async function U(){K.value&&(await Promise.all([z("daily"),z("monthly")]),await q(c.value))}async function z(m){try{const _=await Q.getUserModelStats(K.value,m);if(_.success){const j=_.data||[],V={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};j.forEach(E=>{var H;V.requests+=E.requests||0,V.inputTokens+=E.inputTokens||0,V.outputTokens+=E.outputTokens||0,V.cacheCreateTokens+=E.cacheCreateTokens||0,V.cacheReadTokens+=E.cacheReadTokens||0,V.allTokens+=E.allTokens||0,V.cost+=((H=E.costs)==null?void 0:H.total)||0}),V.formattedCost=Z(V.cost),m==="daily"?w.value=V:p.value=V}else console.warn(`Failed to load ${m} stats:`,_.message)}catch(_){console.error(`Load ${m} stats error:`,_)}}async function q(m="daily"){if(K.value){v.value=!0;try{const _=await Q.getUserModelStats(K.value,m);if(_.success)y.value=_.data||[];else throw new Error(_.message||"加载模型统计失败")}catch(_){console.error("Load model stats error:",_),y.value=[]}finally{v.value=!1}}}async function S(m){if(!(c.value===m||v.value)){if(c.value=m,R.value&&k.value.length>0){await rt(m);return}(m==="daily"&&!w.value||m==="monthly"&&!p.value)&&await z(m),await q(m)}}async function F(){var m,_;if(K.value){a.value=!0,g.value="",f.value=null,y.value=[];try{const j=await Q.getUserStats(K.value);if(j.success)f.value=j.data,console.log("API Stats - Full response:",j.data),console.log("API Stats - limits data:",j.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(m=j.data.limits)==null?void 0:m.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(_=j.data.limits)==null?void 0:_.weeklyOpusCost),await U(),g.value="";else throw new Error(j.message||"查询失败")}catch(j){console.error("Load stats with apiId error:",j),g.value=j.message||"查询统计数据失败",f.value=null,y.value=[]}finally{a.value=!1}}}async function T(){d.value=!0;try{const m=await Q.getOemSettings();m&&m.success&&m.data&&(C.value={...C.value,...m.data})}catch(m){console.error("Error loading OEM settings:",m),C.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{d.value=!1}}function Z(m){return typeof m!="number"||m===0?"$0.000000":m>=1?"$"+m.toFixed(2):m>=.01?"$"+m.toFixed(4):"$"+m.toFixed(6)}function Y(){if(K.value){const m=new URL(window.location);m.searchParams.set("apiId",K.value),window.history.pushState({},"",m)}}async function J(){const m=n();if(m.length===0){g.value="请输入至少一个有效的 API Key";return}a.value=!0,g.value="",u.value=null,i.value=[],M.value=[],y.value=[],h.value=m,k.value=[];try{const _=await Promise.allSettled(m.map(H=>Q.getKeyId(H))),j=[],V=[];if(_.forEach((H,ot)=>{H.status==="fulfilled"&&H.value.success?(j.push(H.value.data.id),V.push(m[ot])):M.value.push(m[ot])}),j.length===0)throw new Error("所有 API Key 都无效");k.value=j,h.value=V;const E=await Q.getBatchStats(j);if(E.success)u.value=E.data.aggregated,i.value=E.data.individual,f.value=E.data.aggregated,w.value=E.data.aggregated.dailyUsage||null,p.value=E.data.aggregated.monthlyUsage||null,await rt(c.value),l();else throw new Error(E.message||"批量查询失败")}catch(_){console.error("Batch query error:",_),g.value=_.message||"批量查询统计数据失败",u.value=null,i.value=[]}finally{a.value=!1}}async function rt(m="daily"){if(k.value.length!==0){v.value=!0;try{const _=await Q.getBatchModelStats(k.value,m);if(_.success)y.value=_.data||[];else throw new Error(_.message||"加载批量模型统计失败")}catch(_){console.error("Load batch model stats error:",_),y.value=[]}finally{v.value=!1}}}function n(){if(!W.value)return[];const m=W.value.split(/[,\n]+/).map(j=>j.trim()).filter(j=>j.length>=10&&j.length<=512);return[...new Set(m)].slice(0,30)}function l(){if(k.value.length>0){const m=new URL(window.location);m.searchParams.set("apiIds",k.value.join(",")),m.searchParams.set("batch","true"),window.history.pushState({},"",m)}}function x(){W.value=""}function L(){f.value=null,y.value=[],w.value=null,p.value=null,g.value="",c.value="daily",K.value=null,h.value=[],k.value=[],u.value=null,i.value=[],M.value=[]}function O(){W.value="",R.value=!1,L()}return{apiKey:W,apiId:K,loading:a,modelStatsLoading:v,oemLoading:d,error:g,statsPeriod:c,statsData:f,modelStats:y,dailyStats:w,monthlyStats:p,oemSettings:C,multiKeyMode:R,apiKeys:h,apiIds:k,aggregatedStats:u,individualStats:i,invalidKeys:M,currentPeriodData:B,usagePercentages:I,queryStats:$,queryBatchStats:J,loadAllPeriodStats:U,loadPeriodStats:z,loadModelStats:q,loadBatchModelStats:rt,switchPeriod:S,loadStatsWithApiId:F,loadOemSettings:T,clearData:L,clearInput:x,reset:O}}),At={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},It={class:"mx-auto max-w-4xl"},Pt={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Mt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Dt={class:"button-group flex items-center gap-2"},jt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Ut={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Rt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},qt={class:"lg:col-span-3"},Nt=["disabled"],Et={key:1,class:"relative"},Ft=["disabled"],Ot={class:"lg:col-span-1"},Wt=["disabled"],Bt={key:0,class:"fas fa-spinner loading-spinner"},Vt={key:1,class:"fas fa-search"},zt={class:"security-notice mt-4"},Yt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Ht={__name:"ApiKeyInput",setup(W){const K=at(),{apiKey:a,loading:v,multiKeyMode:d}=et(K),{queryStats:g,clearInput:c}=K,f=N(()=>{if(!d.value||!a.value)return[];const w=a.value.split(/[,\n]+/).map(C=>C.trim()).filter(C=>C.length>0);return[...new Set(w)].slice(0,30)}),y=N(()=>d.value?f.value.length>0:a.value&&a.value.trim().length>0);return(w,p)=>(r(),o("div",At,[p[15]||(p[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),b(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",It,[t("div",Pt,[t("label",Mt,[p[8]||(p[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),b(" "+s(e(d)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",Dt,[t("div",jt,[t("button",{class:D(["mode-switch-btn",{active:!e(d)}]),title:"单一模式",onClick:p[0]||(p[0]=C=>d.value=!1)},p[9]||(p[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:D(["mode-switch-btn",{active:e(d)}]),title:"聚合模式",onClick:p[1]||(p[1]=C=>d.value=!0)},[p[10]||(p[10]=t("i",{class:"fas fa-layer-group"},null,-1)),p[11]||(p[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(d)&&f.value.length>0?(r(),o("span",Ut,s(f.value.length),1)):P("",!0)],2)])])]),t("div",Rt,[t("div",qt,[e(d)?(r(),o("div",Et,[ct(t("textarea",{"onUpdate:modelValue":p[4]||(p[4]=C=>xt(a)?a.value=C:null),class:"wide-card-input w-full resize-y",disabled:e(v),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:p[5]||(p[5]=gt(vt((...C)=>e(g)&&e(g)(...C),["ctrl"]),["enter"]))},null,40,Ft),[[mt,e(a)]]),e(a)&&!e(v)?(r(),o("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:p[6]||(p[6]=(...C)=>e(c)&&e(c)(...C))},p[12]||(p[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):P("",!0)])):ct((r(),o("input",{key:0,"onUpdate:modelValue":p[2]||(p[2]=C=>xt(a)?a.value=C:null),class:"wide-card-input w-full",disabled:e(v),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:p[3]||(p[3]=gt((...C)=>e(g)&&e(g)(...C),["enter"]))},null,40,Nt)),[[mt,e(a)]])]),t("div",Ot,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(v)||!y.value,onClick:p[7]||(p[7]=(...C)=>e(g)&&e(g)(...C))},[e(v)?(r(),o("i",Bt)):(r(),o("i",Vt)),b(" "+s(e(v)?"查询中...":"查询统计"),1)],8,Wt)])]),t("div",zt,[p[13]||(p[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),b(" "+s(e(d)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(d)?(r(),o("div",Yt,p[14]||(p[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):P("",!0)])]))}},Jt=st(Ht,[["__scopeId","data-v-11e74200"]]),Gt={class:"space-y-6 md:space-y-8"},Qt={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},Xt={class:"card-section"},Zt={class:"section-header"},te={class:"header-title"},ee={key:0,class:"info-grid"},se={class:"info-item"},ae={class:"info-value"},re={class:"info-item"},le={class:"info-value text-green-600 dark:text-emerald-400"},oe={key:0,class:"info-item"},ie={class:"info-value text-red-500 dark:text-red-400"},ne={class:"info-item"},de={class:"info-value"},ue={class:"info-item"},ce={class:"info-value"},me={class:"info-item"},ge={class:"info-value text-indigo-600 dark:text-indigo-300"},xe={key:1,class:"info-item xl:col-span-2"},fe={class:"space-y-2"},ye={class:"truncate"},pe={class:"font-semibold"},ve={key:1,class:"info-grid"},be={class:"info-item"},ke={class:"info-value break-all"},_e={class:"info-item"},he={class:"info-item"},$e={class:"info-value"},we={class:"info-item"},Ce={class:"info-value break-all"},Se={class:"info-item xl:col-span-2"},Te={class:"info-value"},Ke={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Le={key:0,class:"text-red-500 dark:text-red-400"},Ae={key:1,class:"text-orange-500 dark:text-orange-400"},Ie={key:2},Pe={key:2,class:"text-gray-400 dark:text-gray-500"},Me={class:"card-section"},De={class:"section-header"},je={class:"header-tag"},Ue={class:"metric-grid"},Re={class:"metric-card"},qe={class:"metric-value text-green-600 dark:text-emerald-300"},Ne={class:"metric-label"},Ee={class:"metric-card"},Fe={class:"metric-value text-blue-600 dark:text-sky-300"},Oe={class:"metric-label"},We={class:"metric-card"},Be={class:"metric-value text-purple-600 dark:text-violet-300"},Ve={class:"metric-label"},ze={class:"metric-card"},Ye={class:"metric-value text-amber-500 dark:text-amber-300"},He={class:"metric-label"},Je={key:0,class:"card-section"},Ge={class:"flex items-center justify-between gap-3"},Qe={class:"flex items-center gap-3"},Xe={class:"account-name"},Ze={class:"account-sub"},ts={key:0,class:"mt-3 space-y-2"},es={class:"progress-row"},ss={class:"progress-track"},as={class:"progress-value"},rs={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},ls={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},os={key:1,class:"mt-3"},is={key:0,class:"space-y-2"},ns={class:"quota-header"},ds={class:"quota-percent"},us={class:"progress-track"},cs={class:"quota-foot"},ms={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},gs={__name:"StatsOverview",setup(W){const K=at(),{statsData:a,statsPeriod:v,currentPeriodData:d,multiKeyMode:g,aggregatedStats:c,individualStats:f,invalidKeys:y}=et(K),w=N(()=>!f.value||f.value.length===0?[]:[...f.value].sort((n,l)=>{var x,L;return(((x=l.usage)==null?void 0:x.allTokens)||0)-(((L=n.usage)==null?void 0:L.allTokens)||0)}).slice(0,3)),p=n=>{var x;return!c.value||!c.value.usage.allTokens?0:((((x=n.usage)==null?void 0:x.allTokens)||0)/c.value.usage.allTokens*100).toFixed(1)},C=n=>{if(!n)return"无";try{return Tt(n).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},R=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",h=n=>n?new Date(n)<new Date:!1,k=n=>{if(!n)return!1;const L=(new Date(n)-new Date)/(1e3*60*60*24);return L>0&&L<=7},u=n=>(typeof n!="number"&&(n=parseInt(n)||0),n===0?"0":n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toLocaleString()),i=n=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[n]||n||"未知",M=N(()=>{var x,L;const n=(L=(x=a.value)==null?void 0:x.accounts)==null?void 0:L.details;if(!n)return[];const l=[];return n.claude&&n.claude.accountType==="dedicated"&&l.push({key:"claude",...n.claude}),n.openai&&n.openai.accountType==="dedicated"&&l.push({key:"openai",...n.openai}),l}),B=N(()=>{const n=M.value.length;return n<=1?"md:grid-cols-1 lg:grid-cols-1":n===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),I=n=>n?n.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",$=n=>{if(!n||n<=0)return"";const l=Math.floor(n),x=Math.floor(l/1440),L=Math.floor(l%1440/60),O=l%60;return x>0?L>0?`${x}天${L}小时`:`${x}天`:L>0?O>0?`${L}小时${O}分钟`:`${L}小时`:`${O}分钟`},U=n=>{if(!n)return{text:"状态未知",class:"text-gray-400"};if(n.isRateLimited){const l=$(n.minutesRemaining);return{text:`限流中${l?` · 剩余约 ${l}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},z=(n,l)=>{if(!n||!l)return"暂无时间窗口信息";const x=new Date(n),L=new Date(l),O=m=>`${`${m.getHours()}`.padStart(2,"0")}:${`${m.getMinutes()}`.padStart(2,"0")}`;return`${O(x)} - ${O(L)}`},q=n=>{if(!n||n<=0)return"";const l=Math.floor(n/60),x=n%60;return l>0?`${l}小时${x}分钟`:`${x}分钟`},S=(n,l)=>{var L;if(!n)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((L=l==null?void 0:l.rateLimitStatus)!=null&&L.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const x=String(n).toLowerCase();return x==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":x==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},F=n=>{if(!n)return null;const l=typeof n.usedPercent=="number"&&!Number.isNaN(n.usedPercent)?n.usedPercent:null,x=typeof n.resetAfterSeconds=="number"&&!Number.isNaN(n.resetAfterSeconds)?n.resetAfterSeconds:null,L=typeof n.remainingSeconds=="number"?n.remainingSeconds:null,O=n.resetAt?Date.parse(n.resetAt):null;return x!==null&&(L!==null&&L<=0||O!==null&&!Number.isNaN(O)&&Date.now()>=O)?0:l===null?null:Math.max(0,Math.min(100,l))},T=n=>{const l=F(n);return l===null?"bg-gradient-to-r from-gray-300 to-gray-400":l>=90?"bg-gradient-to-r from-red-500 to-red-600":l>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},Z=n=>{const l=F(n);return l===null?"0%":`${l}%`},Y=n=>{const l=F(n);return l===null?"--":`${l.toFixed(1)}%`},J=n=>{if(!n)return"--";let l=n.remainingSeconds;if(l==null&&(l=n.resetAfterSeconds),l==null||Number.isNaN(Number(l)))return"--";l=Math.max(0,Math.floor(Number(l)));const x=Math.floor(l/86400),L=Math.floor(l%86400/3600),O=Math.floor(l%3600/60),m=l%60;return x>0?L>0?`${x}天${L}小时`:`${x}天`:L>0?O>0?`${L}小时${O}分钟`:`${L}小时`:O>0?`${O}分钟`:`${m}秒`},rt=n=>n==="secondary"?"周限":"5h";return(n,l)=>(r(),o("div",Gt,[t("div",Qt,[t("div",Xt,[t("header",Zt,[t("i",{class:D(["header-icon",e(g)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",te,s(e(g)?"批量查询概要":"API Key 信息"),1)]),e(g)&&e(c)?(r(),o("div",ee,[t("div",se,[l[0]||(l[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",ae,s(e(c).totalKeys)+" 个",1)]),t("div",re,[l[2]||(l[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",le,[l[1]||(l[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),b(s(e(c).activeKeys)+" 个 ",1)])]),e(y).length>0?(r(),o("div",oe,[l[4]||(l[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ie,[l[3]||(l[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),b(s(e(y).length)+" 个 ",1)])])):P("",!0),t("div",ne,[l[5]||(l[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",de,s(u(e(c).usage.requests)),1)]),t("div",ue,[l[6]||(l[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",ce,s(u(e(c).usage.allTokens)),1)]),t("div",me,[l[7]||(l[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",ge,s(e(c).usage.formattedCost),1)]),e(f).length>1?(r(),o("div",xe,[l[8]||(l[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",fe,[(r(!0),o(X,null,tt(w.value,x=>(r(),o("div",{key:x.apiId,class:"contributor-item"},[t("span",ye,s(x.name),1),t("span",pe,s(p(x))+"%",1)]))),128))])])):P("",!0)])):(r(),o("div",ve,[t("div",be,[l[9]||(l[9]=t("p",{class:"info-label"},"名称",-1)),t("p",ke,s(e(a).name),1)]),t("div",_e,[l[10]||(l[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:D(["info-value font-semibold",e(a).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:D(["mr-1",e(a).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),b(" "+s(e(a).isActive?"活跃":"已停用"),1)],2)]),t("div",he,[l[11]||(l[11]=t("p",{class:"info-label"},"权限",-1)),t("p",$e,s(i(e(a).permissions)),1)]),t("div",we,[l[12]||(l[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Ce,s(C(e(a).createdAt)),1)]),t("div",Se,[l[17]||(l[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Te,[e(a).expirationMode==="activation"&&!e(a).isActivated?(r(),o(X,{key:0},[l[13]||(l[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),b("未激活 ")],-1)),t("span",Ke," 首次使用后 "+s(e(a).activationDays||(e(a).activationUnit==="hours"?24:30))+" "+s(e(a).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(a).expiresAt?(r(),o(X,{key:1},[h(e(a).expiresAt)?(r(),o("span",Le,l[14]||(l[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),b("已过期 ",-1)]))):k(e(a).expiresAt)?(r(),o("span",Ae,[l[15]||(l[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),b(s(R(e(a).expiresAt)),1)])):(r(),o("span",Ie,s(R(e(a).expiresAt)),1))],64)):(r(),o("span",Pe,l[16]||(l[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),b("永不过期 ",-1)])))])])]))]),t("div",Me,[t("header",De,[l[18]||(l[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),l[19]||(l[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",je,s(e(v)==="daily"?"今日":"本月"),1)]),t("div",Ue,[t("div",Re,[t("p",qe,s(u(e(d).requests)),1),t("p",Ne,s(e(v)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Ee,[t("p",Fe,s(u(e(d).allTokens)),1),t("p",Oe,s(e(v)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",We,[t("p",Be,s(e(d).formattedCost||"$0.000000"),1),t("p",Ve,s(e(v)==="daily"?"今日":"本月")+"费用",1)]),t("div",ze,[t("p",Ye,s(u(e(d).inputTokens)),1),t("p",He,s(e(v)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(g)&&M.value.length>0?(r(),o("div",Je,[l[21]||(l[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:D(["grid grid-cols-1 gap-4",B.value])},[(r(!0),o(X,null,tt(M.value,x=>{var L,O,m,_,j,V;return r(),o("div",{key:x.id||x.key,class:"account-card"},[t("div",Ge,[t("div",Qe,[t("span",{class:D(["account-icon",x.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:D(x.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",Xe,s(I(x)),1),t("p",Ze,s(x.platform==="claude"?"会话窗口":"额度窗口"),1)])]),U(x.rateLimitStatus)?(r(),o("div",{key:0,class:D(["rate-badge",U(x.rateLimitStatus).class])},[l[20]||(l[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),b(" "+s(U(x.rateLimitStatus).text),1)],2)):P("",!0)]),x.platform==="claude"?(r(),o("div",ts,[t("div",es,[t("div",ss,[t("div",{class:D(["progress-bar",S((L=x.sessionWindow)==null?void 0:L.sessionWindowStatus,x)]),style:lt({width:`${Math.min(100,Math.max(0,((O=x.sessionWindow)==null?void 0:O.progress)||0))}%`})},null,6)]),t("span",as,s(Math.min(100,Math.max(0,Math.round(((m=x.sessionWindow)==null?void 0:m.progress)||0))))+"% ",1)]),t("div",rs,[t("span",null,s(z((_=x.sessionWindow)==null?void 0:_.windowStart,(j=x.sessionWindow)==null?void 0:j.windowEnd)),1),((V=x.sessionWindow)==null?void 0:V.remainingTime)>0?(r(),o("span",ls," 剩余 "+s(q(x.sessionWindow.remainingTime)),1)):P("",!0)])])):x.platform==="openai"?(r(),o("div",os,[x.codexUsage?(r(),o("div",is,[(r(),o(X,null,tt(["primary","secondary"],E=>{var H,ot,dt,ut;return t("div",{key:`${x.key}-${E}`,class:"quota-row"},[t("div",ns,[t("span",{class:D(["quota-tag",E==="primary"?"tag-indigo":"tag-blue"])},s(rt(E)),3),t("span",ds,s(Y((H=x.codexUsage)==null?void 0:H[E])),1)]),t("div",us,[t("div",{class:D(["progress-bar",T((ot=x.codexUsage)==null?void 0:ot[E])]),style:lt({width:Z((dt=x.codexUsage)==null?void 0:dt[E])})},null,6)]),t("div",cs," 重置剩余 "+s(J((ut=x.codexUsage)==null?void 0:ut[E])),1)])}),64))])):(r(),o("p",ms," 暂无额度使用数据 "))])):P("",!0)])}),128))],2)])):P("",!0)]))}},xs=st(gs,[["__scopeId","data-v-b72df2cd"]]),fs={class:"card p-4 md:p-6"},ys={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},ps={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},vs={class:"space-y-2 md:space-y-3"},bs={class:"flex items-center justify-between"},ks={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},_s={class:"flex items-center justify-between"},hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},$s={class:"flex items-center justify-between"},ws={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Cs={class:"flex items-center justify-between"},Ss={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ts={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Ks={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Ls={class:"text-sm md:text-base"},As={class:"text-lg md:text-xl"},Is={__name:"TokenDistribution",setup(W){const K=at(),{statsPeriod:a,currentPeriodData:v}=et(K),d=g=>(typeof g!="number"&&(g=parseInt(g)||0),g===0?"0":g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toLocaleString());return(g,c)=>(r(),o("div",fs,[t("h3",ys,[c[0]||(c[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),b(" Token 使用分布 ")],-1)),t("span",ps,"("+s(e(a)==="daily"?"今日":"本月")+")",1)]),t("div",vs,[t("div",bs,[c[1]||(c[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),b(" 输入 Token ")],-1)),t("span",ks,s(d(e(v).inputTokens)),1)]),t("div",_s,[c[2]||(c[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),b(" 输出 Token ")],-1)),t("span",hs,s(d(e(v).outputTokens)),1)]),t("div",$s,[c[3]||(c[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),b(" 缓存创建 Token ")],-1)),t("span",ws,s(d(e(v).cacheCreateTokens)),1)]),t("div",Cs,[c[4]||(c[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),b(" 缓存读取 Token ")],-1)),t("span",Ss,s(d(e(v).cacheReadTokens)),1)])]),t("div",Ts,[t("div",Ks,[t("span",Ls,s(e(a)==="daily"?"今日":"本月")+"总计",1),t("span",As,s(d(e(v).allTokens)),1)])])]))}},Ps=st(Is,[["__scopeId","data-v-d9e5c1dd"]]),Ms={class:"flex h-full flex-col gap-4 md:gap-6"},Ds={class:"card flex h-full flex-col p-4 md:p-6"},js={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Us={key:0,class:"space-y-4"},Rs={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},qs={class:"mb-3 flex items-center justify-between"},Ns={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Es={class:"grid grid-cols-2 gap-3"},Fs={class:"text-center"},Os={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Ws={class:"text-center"},Bs={class:"text-lg font-bold text-green-600"},Vs={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},zs={class:"space-y-2"},Ys={class:"flex items-center justify-between"},Hs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Js={class:"flex items-center justify-between"},Gs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Qs={class:"flex items-center justify-between"},Xs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Zs={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ta={class:"text-red-700 dark:text-red-300"},ea={key:1,class:"space-y-4 md:space-y-5"},sa={class:"mb-2 flex items-center justify-between"},aa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ra={key:0},la={key:1,class:"flex items-center gap-1"},oa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ia={key:1,class:"h-2 w-full rounded-full bg-gray-200"},na={class:"mb-2 flex items-center justify-between"},da={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ua={key:0},ca={key:1,class:"flex items-center gap-1"},ma={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ga={key:1,class:"h-2 w-full rounded-full bg-gray-200"},xa={key:0},fa={class:"mb-2 flex items-center justify-between"},ya={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},pa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},va={key:1},ba={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ka={key:0},_a={key:1},ha={key:2},$a={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},wa={class:"flex items-center justify-between"},Ca={class:"text-sm font-medium text-gray-900 md:text-base"},Sa={key:0},Ta={key:1,class:"flex items-center gap-1"},Ka={class:"flex items-center justify-between"},La={class:"text-sm font-medium text-gray-900 md:text-base"},Aa={key:0,class:"text-orange-600"},Ia={key:1,class:"text-green-600"},Pa={class:"space-y-2"},Ma={class:"flex items-center justify-between"},Da={class:"text-sm font-medium text-gray-900 md:text-base"},ja={key:0,class:"text-orange-600"},Ua={key:1,class:"text-green-600"},Ra={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},qa={key:0,class:"card p-4 md:p-6"},Na={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Ea={class:"space-y-1 md:space-y-2"},Fa={class:"break-all text-gray-800 dark:text-gray-200"},Oa={__name:"LimitConfig",setup(W){const K=at(),{statsData:a,multiKeyMode:v,aggregatedStats:d,invalidKeys:g}=et(K),c=N(()=>{var i;const u=(i=a.value)==null?void 0:i.restrictions;return u?u.enableModelRestriction===!0&&Array.isArray(u.restrictedModels)&&u.restrictedModels.length>0:!1}),f=N(()=>{var i;const u=(i=a.value)==null?void 0:i.restrictions;return u?u.enableClientRestriction===!0&&Array.isArray(u.allowedClients)&&u.allowedClients.length>0:!1}),y=()=>{if(!a.value.limits.dailyCostLimit||a.value.limits.dailyCostLimit===0)return 0;const u=a.value.limits.currentDailyCost/a.value.limits.dailyCostLimit*100;return Math.min(u,100)},w=()=>{const u=y();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-green-500"},p=()=>{if(!a.value.limits.totalCostLimit||a.value.limits.totalCostLimit===0)return 0;const u=a.value.limits.currentTotalCost/a.value.limits.totalCostLimit*100;return Math.min(u,100)},C=()=>{const u=p();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-blue-500"},R=()=>{if(!a.value.limits.weeklyOpusCostLimit||a.value.limits.weeklyOpusCostLimit===0)return 0;const u=a.value.limits.weeklyOpusCost/a.value.limits.weeklyOpusCostLimit*100;return Math.min(u,100)},h=()=>{const u=R();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-indigo-500"},k=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,i)=>(r(),o("div",Ms,[t("div",Ds,[t("h3",js,[i[0]||(i[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),b(" "+s(e(v)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(v)&&e(d)?(r(),o("div",Us,[t("div",Rs,[t("div",qs,[i[1]||(i[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),b(" API Keys 概况 ")],-1)),t("span",Ns,s(e(d).activeKeys)+"/"+s(e(d).totalKeys),1)]),t("div",Es,[t("div",Fs,[t("div",Os,s(e(d).totalKeys),1),i[2]||(i[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Ws,[t("div",Bs,s(e(d).activeKeys),1),i[3]||(i[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",Vs,[i[7]||(i[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",zs,[t("div",Ys,[i[4]||(i[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),b(" 总请求数 ")],-1)),t("span",Hs,s(k(e(d).usage.requests)),1)]),t("div",Js,[i[5]||(i[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),b(" 总 Tokens ")],-1)),t("span",Gs,s(k(e(d).usage.allTokens)),1)]),t("div",Qs,[i[6]||(i[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),b(" 总费用 ")],-1)),t("span",Xs,s(e(d).usage.formattedCost),1)])])]),e(g)&&e(g).length>0?(r(),o("div",Zs,[i[8]||(i[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",ta,s(e(g).length)+" 个无效的 API Key ",1)])):P("",!0),i[9]||(i[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),b(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):P("",!0),e(v)?P("",!0):(r(),o("div",ea,[t("div",null,[t("div",sa,[i[11]||(i[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",aa,[e(a).limits.dailyCostLimit>0?(r(),o("span",ra," $"+s(e(a).limits.currentDailyCost.toFixed(4))+" / $"+s(e(a).limits.dailyCostLimit.toFixed(2)),1)):(r(),o("span",la,[b(" $"+s(e(a).limits.currentDailyCost.toFixed(4))+" / ",1),i[10]||(i[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.dailyCostLimit>0?(r(),o("div",oa,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",w()]),style:lt({width:y()+"%"})},null,6)])):(r(),o("div",ia,i[12]||(i[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",na,[i[14]||(i[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",da,[e(a).limits.totalCostLimit>0?(r(),o("span",ua," $"+s(e(a).limits.currentTotalCost.toFixed(4))+" / $"+s(e(a).limits.totalCostLimit.toFixed(2)),1)):(r(),o("span",ca,[b(" $"+s(e(a).limits.currentTotalCost.toFixed(4))+" / ",1),i[13]||(i[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.totalCostLimit>0?(r(),o("div",ma,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",C()]),style:lt({width:p()+"%"})},null,6)])):(r(),o("div",ga,i[15]||(i[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(a).limits.weeklyOpusCostLimit>0?(r(),o("div",xa,[t("div",fa,[i[16]||(i[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",ya," $"+s(e(a).limits.weeklyOpusCost.toFixed(4))+" / $"+s(e(a).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",pa,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",h()]),style:lt({width:R()+"%"})},null,6)])])):P("",!0),e(a).limits.rateLimitWindow>0&&(e(a).limits.rateLimitRequests>0||e(a).limits.tokenLimit>0||e(a).limits.rateLimitCost>0)?(r(),o("div",va,[G(Kt,{"cost-limit":e(a).limits.rateLimitCost,"current-cost":e(a).limits.currentWindowCost,"current-requests":e(a).limits.currentWindowRequests,"current-tokens":e(a).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(a).limits.rateLimitWindow,"request-limit":e(a).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(a).limits.tokenLimit,"window-end-time":e(a).limits.windowEndTime,"window-remaining-seconds":e(a).limits.windowRemainingSeconds,"window-start-time":e(a).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",ba,[i[17]||(i[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(a).limits.rateLimitCost>0?(r(),o("span",ka,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(a).limits.tokenLimit>0?(r(),o("span",_a,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(r(),o("span",ha," 仅限制请求次数 "))])])):P("",!0),t("div",$a,[t("div",wa,[i[19]||(i[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ca,[e(a).limits.concurrencyLimit>0?(r(),o("span",Sa,s(e(a).limits.concurrencyLimit),1)):(r(),o("span",Ta,i[18]||(i[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Ka,[i[22]||(i[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",La,[c.value?(r(),o("span",Aa,[i[20]||(i[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限制 "+s(e(a).restrictions.restrictedModels.length)+" 个模型 ",1)])):(r(),o("span",Ia,i[21]||(i[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有模型 ",-1)])))])]),t("div",Pa,[t("div",Ma,[i[25]||(i[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",Da,[f.value?(r(),o("span",ja,[i[23]||(i[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限 "+s(e(a).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(r(),o("span",Ua,i[24]||(i[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有客户端 ",-1)])))])]),f.value?(r(),o("div",Ra,[(r(!0),o(X,null,tt(e(a).restrictions.allowedClients,M=>(r(),o("span",{key:M,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[i[26]||(i[26]=t("i",{class:"fas fa-id-badge"},null,-1)),b(" "+s(M),1)]))),128))])):P("",!0)])])]))]),c.value?(r(),o("div",qa,[i[30]||(i[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),b(" 详细限制信息 ")],-1)),t("div",Na,[i[28]||(i[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),b(" 受限模型列表 ")],-1)),t("div",Ea,[(r(!0),o(X,null,tt(e(a).restrictions.restrictedModels,M=>(r(),o("div",{key:M,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[i[27]||(i[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Fa,s(M),1)]))),128))]),i[29]||(i[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),b(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):P("",!0)]))}},Wa=st(Oa,[["__scopeId","data-v-4e85e423"]]),Ba={class:"card h-full p-4 md:p-6"},Va={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},za={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ya={key:0,class:"space-y-2 md:space-y-3"},Ha={class:"mb-1 flex items-center justify-between text-sm"},Ja={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Ga={class:"text-xs text-gray-600 dark:text-gray-400"},Qa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Xa={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},Za={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},tr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},er={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},sr={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},ar={__name:"AggregatedStatsCard",setup(W){const K=at(),{aggregatedStats:a,individualStats:v,statsPeriod:d,multiKeyMode:g}=et(K),c=h=>h?d.value==="daily"?h.dailyUsage||h.usage:h.monthlyUsage||h.usage:null,f=N(()=>!v.value||v.value.length===0?[]:[...v.value].sort((h,k)=>{const u=c(h),i=c(k);return((i==null?void 0:i.cost)||0)-((u==null?void 0:u.cost)||0)}).slice(0,5)),y=N(()=>v.value?Math.max(0,v.value.length-5):0),w=N(()=>{var i,M;if(!v.value||!a.value)return 0;const h=f.value.reduce((B,I)=>{const $=c(I);return B+(($==null?void 0:$.cost)||0)},0),k=d.value==="daily"?((i=a.value.dailyUsage)==null?void 0:i.cost)||0:((M=a.value.monthlyUsage)==null?void 0:M.cost)||0;if(k===0)return 0;const u=k-h;return Math.max(0,Math.round(u/k*100))}),p=h=>{var M,B;if(!a.value)return 0;const k=d.value==="daily"?((M=a.value.dailyUsage)==null?void 0:M.cost)||0:((B=a.value.monthlyUsage)==null?void 0:B.cost)||0;if(k===0)return 0;const u=c(h),i=((u==null?void 0:u.cost)||0)/k*100;return Math.round(i)},C=h=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][h]||"bg-gray-400",R=h=>(typeof h!="number"&&(h=parseInt(h)||0),h===0?"0":h>=1e6?(h/1e6).toFixed(1)+"M":h>=1e3?(h/1e3).toFixed(1)+"K":h.toLocaleString());return(h,k)=>(r(),o("div",Ba,[t("h3",Va,[k[0]||(k[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),b(" 使用占比 ")],-1)),t("span",za,"("+s(e(d)==="daily"?"今日":"本月")+")",1)]),e(a)&&e(v).length>0?(r(),o("div",Ya,[(r(!0),o(X,null,tt(f.value,(u,i)=>{var M,B;return r(),o("div",{key:u.apiId,class:"relative"},[t("div",Ha,[t("span",Ja,s(u.name||`Key ${i+1}`),1),t("span",Ga,s(p(u))+"% ",1)]),t("div",Qa,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",C(i)]),style:lt({width:p(u)+"%"})},null,6)]),t("div",Xa,[t("span",null,s(R(((M=c(u))==null?void 0:M.requests)||0))+"次",1),t("span",null,s(((B=c(u))==null?void 0:B.formattedCost)||"$0.00"),1)])])}),128)),y.value>0?(r(),o("div",Za,[t("div",tr,[t("span",null,"其他 "+s(y.value)+" 个Keys",1),t("span",null,s(w.value)+"%",1)])])):P("",!0)])):e(g)?(r(),o("div",sr,k[2]||(k[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),b(" 暂无数据 ",-1)]))):(r(),o("div",er,k[1]||(k[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},rr=st(ar,[["__scopeId","data-v-39572a8e"]]),lr={class:"card p-4 md:p-6"},or={class:"mb-4 md:mb-6"},ir={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},nr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},dr={key:0,class:"py-6 text-center md:py-8"},ur={key:1,class:"space-y-3 md:space-y-4"},cr={class:"mb-2 flex items-start justify-between md:mb-3"},mr={class:"min-w-0 flex-1"},gr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},xr={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},fr={class:"ml-3 flex-shrink-0 text-right"},yr={class:"text-base font-bold text-green-600 md:text-lg"},pr={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},vr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},br={class:"font-medium text-gray-900 dark:text-gray-100"},kr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},_r={class:"font-medium text-gray-900 dark:text-gray-100"},hr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},$r={class:"font-medium text-gray-900 dark:text-gray-100"},wr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Cr={class:"font-medium text-gray-900 dark:text-gray-100"},Sr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Tr={class:"text-sm md:text-base"},Kr={__name:"ModelUsageStats",setup(W){const K=at(),{statsPeriod:a,modelStats:v,modelStatsLoading:d}=et(K),g=c=>(typeof c!="number"&&(c=parseInt(c)||0),c===0?"0":c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(1)+"K":c.toLocaleString());return(c,f)=>(r(),o("div",lr,[t("div",or,[t("h3",ir,[f[0]||(f[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),b(" 模型使用统计 ")],-1)),t("span",nr,"("+s(e(a)==="daily"?"今日":"本月")+")",1)])]),e(d)?(r(),o("div",dr,f[1]||(f[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(v).length>0?(r(),o("div",ur,[(r(!0),o(X,null,tt(e(v),(y,w)=>{var p;return r(),o("div",{key:w,class:"model-usage-item"},[t("div",cr,[t("div",mr,[t("h4",gr,s(y.model),1),t("p",xr,s(y.requests)+" 次请求 ",1)]),t("div",fr,[t("div",yr,s(((p=y.formatted)==null?void 0:p.total)||"$0.000000"),1),f[2]||(f[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",pr,[t("div",vr,[f[3]||(f[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",br,s(g(y.inputTokens)),1)]),t("div",kr,[f[4]||(f[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",_r,s(g(y.outputTokens)),1)]),t("div",hr,[f[5]||(f[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",$r,s(g(y.cacheCreateTokens)),1)]),t("div",wr,[f[6]||(f[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Cr,s(g(y.cacheReadTokens)),1)])])])}),128))])):(r(),o("div",Sr,[f[7]||(f[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Tr," 暂无"+s(e(a)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Lr=st(Kr,[["__scopeId","data-v-b3b8dc5f"]]),Ar={class:"usage-logs-container"},Ir={class:"mb-4 flex items-center justify-between border-b border-gray-200 pb-4 dark:border-gray-700"},Pr=["disabled"],Mr={key:0,class:"flex justify-center py-12"},Dr={key:1,class:"rounded-lg bg-red-50 p-4 text-red-800 dark:bg-red-900/20 dark:text-red-200"},jr={key:2},Ur={class:"summary-grid mb-4 grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-5"},Rr={class:"summary-card"},qr={class:"summary-value"},Nr={class:"summary-card"},Er={class:"summary-value text-green-600 dark:text-green-400"},Fr={class:"summary-card"},Or={class:"summary-value"},Wr={class:"summary-card"},Br={class:"summary-value"},Vr={class:"summary-card"},zr={class:"summary-value"},Yr={class:"logs-table-container overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700"},Hr={class:"w-full"},Jr={class:"divide-y divide-gray-200 dark:divide-gray-700"},Gr={class:"table-cell whitespace-nowrap"},Qr={class:"flex flex-col gap-0.5"},Xr={class:"text-xs font-medium text-gray-900 dark:text-gray-100"},Zr={class:"text-xs text-gray-500 dark:text-gray-400"},tl={class:"table-cell"},el={class:"model-badge"},sl={class:"table-cell text-right"},al={class:"token-badge"},rl={class:"table-cell text-right"},ll={class:"token-badge"},ol={class:"table-cell text-right"},il={key:0,class:"cache-badge"},nl={key:1,class:"text-gray-400"},dl={class:"table-cell text-right"},ul={key:0,class:"cache-badge"},cl={key:1,class:"text-gray-400"},ml={class:"table-cell text-right font-semibold text-gray-900 dark:text-gray-100"},gl={class:"table-cell text-right"},xl={class:"cost-badge"},fl={class:"table-cell"},yl={key:0,class:"flex flex-col gap-0.5"},pl={class:"text-xs text-gray-600 dark:text-gray-300"},vl={class:"font-mono text-xs text-gray-400 dark:text-gray-500"},bl={key:1,class:"text-gray-400"},kl={class:"mt-4 flex items-center justify-between"},_l={class:"text-sm text-gray-600 dark:text-gray-400"},hl={class:"flex gap-2"},$l=["disabled"],wl=["disabled"],Cl={key:3,class:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400"},Sl={__name:"UsageLogs",setup(W,{expose:K}){const a=at(),{apiId:v,apiKey:d}=et(a),g=A([]),c=A(!1),f=A(null),y=A({total:0,limit:50,offset:0,hasMore:!1}),w=A({totalCost:0,formattedCost:"$0.000000",totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCacheCreateTokens:0,totalCacheReadTokens:0}),p=N(()=>y.value.limit),C=N(()=>y.value.offset),R=async()=>{if(!v.value&&!d.value){f.value="请先输入 API Key 或 API ID";return}c.value=!0,f.value=null;try{const I=await Q.getUsageLogs({apiId:v.value||void 0,apiKey:d.value||void 0,limit:y.value.limit,offset:y.value.offset});I.success?(g.value=I.data.records,y.value=I.data.pagination,w.value=I.data.summary):f.value=I.message||"加载失败"}catch(I){console.error("Failed to load usage logs:",I),f.value=I.message||"加载使用日志失败"}finally{c.value=!1}},h=()=>{y.value.hasMore&&(y.value.offset+=y.value.limit,R())},k=()=>{y.value.offset>0&&(y.value.offset=Math.max(0,y.value.offset-y.value.limit),R())},u=I=>I?I.toLocaleString():"0",i=I=>I?I.replace("claude-3-5-sonnet-","sonnet-").replace("claude-3-opus-","opus-").replace("claude-3-haiku-","haiku-"):"unknown",M=I=>I?new Date(I).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):"-",B=I=>I?new Date(I).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-";return nt([v,d],()=>{y.value.offset=0,g.value=[],w.value={totalCost:0,formattedCost:"$0.000000",totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCacheCreateTokens:0,totalCacheReadTokens:0},(v.value||d.value)&&R()}),K({loadUsageLogs:R}),(I,$)=>(r(),o("div",Ar,[t("div",Ir,[$[1]||($[1]=t("div",{class:"flex items-center gap-2"},[t("i",{class:"fas fa-history text-lg text-purple-500"}),t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},"使用日志")],-1)),t("button",{class:"refresh-button flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all",disabled:c.value,onClick:R},[t("i",{class:D(["fas fa-sync-alt",{"fa-spin":c.value}])},null,2),$[0]||($[0]=b(" 刷新 ",-1))],8,Pr)]),c.value&&!g.value.length?(r(),o("div",Mr,$[2]||($[2]=[t("div",{class:"flex items-center gap-3"},[t("i",{class:"fas fa-spinner fa-spin text-2xl text-purple-500"}),t("span",{class:"text-gray-600 dark:text-gray-300"},"加载中...")],-1)]))):f.value?(r(),o("div",Dr,[$[3]||($[3]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),b(" "+s(f.value),1)])):g.value.length>0?(r(),o("div",jr,[t("div",Ur,[t("div",Rr,[$[4]||($[4]=t("div",{class:"summary-label"},"总请求数",-1)),t("div",qr,s(y.value.total),1)]),t("div",Nr,[$[5]||($[5]=t("div",{class:"summary-label"},"总费用",-1)),t("div",Er,s(w.value.formattedCost),1)]),t("div",Fr,[$[6]||($[6]=t("div",{class:"summary-label"},"总 Tokens",-1)),t("div",Or,s(u(w.value.totalTokens)),1)]),t("div",Wr,[$[7]||($[7]=t("div",{class:"summary-label"},"输入 Tokens",-1)),t("div",Br,s(u(w.value.totalInputTokens)),1)]),t("div",Vr,[$[8]||($[8]=t("div",{class:"summary-label"},"输出 Tokens",-1)),t("div",zr,s(u(w.value.totalOutputTokens)),1)])]),t("div",Yr,[t("table",Hr,[$[9]||($[9]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"table-header"},"时间"),t("th",{class:"table-header"},"模型"),t("th",{class:"table-header text-right"},"输入"),t("th",{class:"table-header text-right"},"输出"),t("th",{class:"table-header text-right"},"缓存创建"),t("th",{class:"table-header text-right"},"缓存读取"),t("th",{class:"table-header text-right"},"总计"),t("th",{class:"table-header text-right"},"费用"),t("th",{class:"table-header"},"账户")])],-1)),t("tbody",Jr,[(r(!0),o(X,null,tt(g.value,(U,z)=>(r(),o("tr",{key:z,class:"log-row"},[t("td",Gr,[t("div",Qr,[t("span",Xr,s(M(U.timestamp)),1),t("span",Zr,s(B(U.timestamp)),1)])]),t("td",tl,[t("div",el,s(i(U.model)),1)]),t("td",sl,[t("span",al,s(u(U.inputTokens)),1)]),t("td",rl,[t("span",ll,s(u(U.outputTokens)),1)]),t("td",ol,[U.cacheCreateTokens>0?(r(),o("span",il,s(u(U.cacheCreateTokens)),1)):(r(),o("span",nl,"-"))]),t("td",dl,[U.cacheReadTokens>0?(r(),o("span",ul,s(u(U.cacheReadTokens)),1)):(r(),o("span",cl,"-"))]),t("td",ml,s(u(U.totalTokens)),1),t("td",gl,[t("span",xl,"$"+s(U.cost.toFixed(6)),1)]),t("td",fl,[U.accountId?(r(),o("div",yl,[t("span",pl,s(U.accountType||"unknown"),1),t("span",vl,s(U.accountId.substring(0,8))+"... ",1)])):(r(),o("span",bl,"-"))])]))),128))])])]),t("div",kl,[t("div",_l," 显示 "+s(C.value+1)+"-"+s(Math.min(C.value+p.value,y.value.total))+" / 共 "+s(y.value.total)+" 条 ",1),t("div",hl,[t("button",{class:"pagination-button",disabled:C.value===0||c.value,onClick:k},$[10]||($[10]=[t("i",{class:"fas fa-chevron-left"},null,-1),b(" 上一页 ",-1)]),8,$l),t("button",{class:"pagination-button",disabled:!y.value.hasMore||c.value,onClick:h},$[11]||($[11]=[b(" 下一页 ",-1),t("i",{class:"fas fa-chevron-right"},null,-1)]),8,wl)])])])):(r(),o("div",Cl,$[12]||($[12]=[t("i",{class:"fas fa-inbox mb-3 text-4xl"},null,-1),t("p",null,"暂无使用日志",-1)])))]))}},Tl=st(Sl,[["__scopeId","data-v-58e41aeb"]]),Kl={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},Ll={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},Al={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Il={class:"flex items-center gap-3"},Pl={class:"text-xs text-gray-500 dark:text-gray-400"},Ml=["disabled"],Dl={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},jl={class:"mb-4"},Ul={class:"relative"},Rl=["value"],ql={class:"mb-4 space-y-2"},Nl={class:"flex items-center justify-between text-sm"},El={class:"font-medium text-gray-700 dark:text-gray-300"},Fl={class:"flex items-center gap-3"},Ol={class:"text-xs text-gray-500 dark:text-gray-400"},Wl={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},Bl={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},Vl={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},zl={class:"max-h-40 overflow-y-auto p-3"},Yl={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},Hl={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},Jl={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},Gl={key:2,class:"text-sm text-red-600 dark:text-red-400"},Ql={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},Xl={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},Zl=["disabled"],to=["disabled"],eo={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(W,{emit:K}){const a=W,v=K,d=A("idle"),g=A(""),c=A(""),f=A(0),y=A(null),w=A(null),p=A("claude-sonnet-4-5-20250929"),C=N(()=>a.apiKeyName||"当前 API Key"),R=N(()=>{const q=a.apiKeyValue;return q?q.length<=10?"****":q.substring(0,6)+"****"+q.substring(q.length-4):""}),h=N(()=>{switch(d.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),k=N(()=>{switch(d.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return c.value||"无法通过 API Key 访问服务";default:return""}}),u=N(()=>{switch(d.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),i=N(()=>{switch(d.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),M=N(()=>{switch(d.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),B=N(()=>{switch(d.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),I=N(()=>{switch(d.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function $(){if(!a.apiKeyValue)return;d.value="testing",g.value="",c.value="",f.value=0,y.value=Date.now(),w.value&&w.value.abort(),w.value=new AbortController;const q=`${$t}/apiStats/api-key/test`;try{const S=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:a.apiKeyValue,model:p.value}),signal:w.value.signal});if(!S.ok){const Y=await S.json().catch(()=>({}));throw new Error(Y.message||Y.error||`HTTP ${S.status}`)}const F=S.body.getReader(),T=new TextDecoder;let Z=!1;for(;!Z;){const{done:Y,value:J}=await F.read();if(Y){Z=!0;continue}const n=T.decode(J).split(`
`);for(const l of n)if(l.startsWith("data: "))try{const x=JSON.parse(l.substring(6));U(x)}catch{}}}catch(S){if(S.name==="AbortError")return;d.value="error",c.value=S.message||"连接失败",f.value=Date.now()-y.value}}function U(q){switch(q.type){case"test_start":break;case"content":g.value+=q.text;break;case"message_stop":break;case"test_complete":f.value=Date.now()-y.value,q.success?d.value="success":(d.value="error",c.value=q.error||"测试失败");break;case"error":d.value="error",c.value=q.error||"未知错误",f.value=Date.now()-y.value;break}}function z(){d.value!=="testing"&&(w.value&&(w.value.abort(),w.value=null),d.value="idle",g.value="",c.value="",f.value=0,v("close"))}return nt(()=>a.show,q=>{q&&(d.value="idle",g.value="",c.value="",f.value=0)}),yt(()=>{w.value&&w.value.abort()}),(q,S)=>(r(),it(bt,{to:"body"},[W.show?(r(),o("div",Kl,[t("div",{class:"absolute inset-0",onClick:z}),t("div",Ll,[t("div",Al,[t("div",Il,[t("div",{class:D(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",d.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":d.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[t("i",{class:D(["fas",d.value==="idle"?"fa-vial":d.value==="testing"?"fa-spinner fa-spin":d.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[S[0]||(S[0]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",Pl,s(C.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:d.value==="testing",onClick:z},S[1]||(S[1]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,Ml)]),t("div",Dl,[t("div",jl,[S[3]||(S[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",Ul,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:R.value},null,8,Rl),S[2]||(S[2]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),S[4]||(S[4]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",ql,[S[6]||(S[6]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点"),t("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},[t("i",{class:"fas fa-link"}),b(" /api/v1/messages ")])],-1)),t("div",Nl,[S[5]||(S[5]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",El,s(p.value),1)]),S[7]||(S[7]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端"),t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Claude Code")],-1))]),t("div",{class:D(["mb-4 rounded-xl border p-4 transition-all duration-300",u.value])},[t("div",Fl,[t("div",{class:D(["flex h-8 w-8 items-center justify-center rounded-lg",i.value])},[t("i",{class:D(["fas text-sm",M.value,B.value])},null,2)],2),t("div",null,[t("p",{class:D(["font-medium",I.value])},s(h.value),3),t("p",Ol,s(k.value),1)])])],2),d.value!=="idle"?(r(),o("div",Wl,[t("div",Bl,[S[8]||(S[8]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),g.value?(r(),o("span",Vl,s(g.value.length)+" 字符 ",1)):P("",!0)]),t("div",zl,[g.value?(r(),o("p",Yl,[b(s(g.value)+" ",1),d.value==="testing"?(r(),o("span",Hl)):P("",!0)])):d.value==="testing"?(r(),o("p",Jl,S[9]||(S[9]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),b(" 等待响应中... ",-1)]))):d.value==="error"&&c.value?(r(),o("p",Gl,s(c.value),1)):P("",!0)])])):P("",!0),f.value>0?(r(),o("div",Ql,[S[10]||(S[10]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+s((f.value/1e3).toFixed(2))+" 秒",1)])):P("",!0)]),t("div",Xl,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:d.value==="testing",onClick:z}," 关闭 ",8,Zl),t("button",{class:D(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",d.value==="testing"||!W.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:d.value==="testing"||!W.apiKeyValue,onClick:$},[t("i",{class:D(["fas",d.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),b(" "+s(d.value==="testing"?"测试中...":d.value==="idle"?"开始测试":"重新测试"),1)],10,to)])])])):P("",!0)]))}},so={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},ao={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},ro={class:"flex items-center gap-2 md:gap-4"},lo={class:"flex items-center"},oo={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},io={class:"mb-6 md:mb-8"},no={class:"flex justify-center"},uo={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},co={key:0,class:"tab-content"},mo={key:0,class:"mb-6 md:mb-8"},go={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},xo={key:1,class:"fade-in"},fo={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},yo={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},po={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},vo={class:"flex w-full items-center gap-2 md:w-auto"},bo=["disabled"],ko=["disabled"],_o=["disabled"],ho={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},$o={class:"mt-6 md:mt-8"},wo={key:1,class:"tab-content"},Co={class:"glass-strong rounded-3xl shadow-xl"},So={__name:"ApiStatsView",setup(W){const K=_t(),a=at(),v=wt(),d=A("stats"),g=N(()=>v.isDarkMode),{apiKey:c,apiId:f,loading:y,modelStatsLoading:w,oemLoading:p,error:C,statsPeriod:R,statsData:h,oemSettings:k,multiKeyMode:u}=et(a),{queryStats:i,switchPeriod:M,loadStatsWithApiId:B,loadOemSettings:I,reset:$}=a,U=A(!1),z=()=>{U.value=!0},q=()=>{U.value=!1},S=F=>{(F.ctrlKey||F.metaKey)&&F.key==="Enter"&&(!y.value&&c.value.trim()&&i(),F.preventDefault()),F.key==="Escape"&&$()};return kt(()=>{v.initTheme(),I();const F=K.query.apiId,T=K.query.apiKey;F&&F.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(f.value=F,B()):T&&T.length>10&&(c.value=T),document.addEventListener("keydown",S)}),yt(()=>{document.removeEventListener("keydown",S)}),nt(c,F=>{F||a.clearData()}),(F,T)=>{var Y;const Z=ht("router-link");return r(),o("div",{class:D(["min-h-screen p-4 md:p-6",g.value?"gradient-bg-dark":"gradient-bg"])},[t("div",so,[t("div",ao,[G(Ct,{loading:e(p),"logo-src":e(k).siteIconData||e(k).siteIcon,subtitle:d.value==="stats"?"API Key 使用统计":"使用教程",title:e(k).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",ro,[t("div",lo,[G(St,{mode:"dropdown"})]),e(k).ldapEnabled||e(k).showAdminButton!==!1?(r(),o("div",oo)):P("",!0),e(k).ldapEnabled?(r(),it(Z,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:ft(()=>T[4]||(T[4]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[4]})):P("",!0),e(k).showAdminButton!==!1?(r(),it(Z,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:ft(()=>T[5]||(T[5]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[5]})):P("",!0)])])]),t("div",io,[t("div",no,[t("div",uo,[t("button",{class:D(["tab-pill-button",d.value==="stats"?"active":""]),onClick:T[0]||(T[0]=J=>d.value="stats")},T[6]||(T[6]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:D(["tab-pill-button",d.value==="tutorial"?"active":""]),onClick:T[1]||(T[1]=J=>d.value="tutorial")},T[7]||(T[7]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),d.value==="stats"?(r(),o("div",co,[G(Jt),e(C)?(r(),o("div",mo,[t("div",go,[T[8]||(T[8]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),b(" "+s(e(C)),1)])])):P("",!0),e(h)?(r(),o("div",xo,[t("div",fo,[t("div",yo,[t("div",po,[T[12]||(T[12]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",vo,[t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(R)==="daily"}]]),disabled:e(y)||e(w),onClick:T[2]||(T[2]=J=>e(M)("daily"))},T[9]||(T[9]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),b(" 今日 ",-1)]),10,bo),t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(R)==="monthly"}]]),disabled:e(y)||e(w),onClick:T[3]||(T[3]=J=>e(M)("monthly"))},T[10]||(T[10]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),b(" 本月 ",-1)]),10,ko),e(u)?P("",!0):(r(),o("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:e(y),onClick:z},T[11]||(T[11]=[t("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),b(" 测试 ",-1)]),8,_o))])])]),G(xs),t("div",ho,[G(Ps,{class:"h-full"}),e(u)?(r(),it(rr,{key:0,class:"h-full"})):(r(),it(Wa,{key:1,class:"h-full"}))]),G(Lr),t("div",$o,[G(Tl)])])])):P("",!0)])):P("",!0),d.value==="tutorial"?(r(),o("div",wo,[t("div",Co,[G(Lt)])])):P("",!0),G(eo,{"api-key-name":((Y=e(h))==null?void 0:Y.name)||"","api-key-value":e(c),show:U.value,onClose:q},null,8,["api-key-name","api-key-value","show"])],2)}}},Uo=st(So,[["__scopeId","data-v-22dac999"]]);export{Uo as default};
