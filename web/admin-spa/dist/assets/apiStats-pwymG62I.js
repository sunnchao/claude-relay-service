class n{constructor(){this.baseURL=window.location.origin,this.isDev=!1}getAdminToken(){try{return localStorage.getItem("authToken")||""}catch(t){return console.warn("Unable to read auth token for API stats:",t),""}}async request(t,e={}){try{this.isDev&&t.startsWith("/admin")&&(t="/webapi"+t);const s={"Content-Type":"application/json",...e.headers},r=this.getAdminToken();r&&!s.Authorization&&(s.Authorization=`Bearer ${r}`);const i=await fetch(`${this.baseURL}${t}`,{credentials:e.credentials||"same-origin",...e,headers:s}),o=await i.json();if(!i.ok)throw new Error(o.message||`请求失败: ${i.status}`);return o}catch(s){throw console.error("API Stats request error:",s),s}}async getKeyId(t){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:t})})}async getUserStats(t){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:t})})}async getUserModelStats(t,e="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:t,period:e})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(t){return console.error("Failed to load OEM settings:",t),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(t){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:t})})}async getBatchModelStats(t,e="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:t,period:e})})}async getUsageLogs(t={}){const{apiId:e,apiKey:s,limit:r,offset:i,params:o={}}=t,a={...o};return a.limit=typeof r<"u"?r:typeof a.limit<"u"?a.limit:50,a.offset=typeof i<"u"?i:typeof a.offset<"u"?a.offset:0,e?a.apiId=e:s&&(a.apiKey=s),this.request("/apiStats/api/usage-logs",{method:"POST",body:JSON.stringify(a)})}}const c=new n;export{c as a};
